<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Root Word Game</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f4f8;
            text-align: center;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 90vh;
            max-width: 600px;
            margin: 0 auto;
        }
        h1 { color: #333; font-size: 2.5rem; margin-bottom: 10px; margin-top: 0; }
        .question-text { font-size: 1.2rem; color: #666; margin-bottom: 20px; }
        
        /* Progress Bar */
        .progress-container {
            width: 100%;
            background-color: #ddd;
            border-radius: 10px;
            margin-bottom: 20px;
            height: 10px;
        }
        .progress-bar {
            height: 100%;
            background-color: #007bff;
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s;
        }
        .level-indicator {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 10px;
        }

        .btn-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        button {
            background-color: white;
            border: 2px solid #007bff;
            color: #007bff;
            padding: 18px;
            font-size: 1.3rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.1s;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        button:active { transform: scale(0.96); background-color: #e6f0ff; }
        
        /* Feedback Styles */
        .correct { 
            background-color: #d4edda !important; 
            border-color: #28a745 !important; 
            color: #155724 !important; 
        }
        .wrong { 
            background-color: #f8d7da !important; 
            border-color: #dc3545 !important; 
            color: #721c24 !important; 
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .jp-sub {
            display: block;
            font-size: 0.8rem;
            font-weight: normal;
            color: #888;
            margin-top: 4px;
        }

        .reset-link {
            margin-top: 30px;
            color: #999;
            text-decoration: underline;
            font-size: 0.8rem;
            cursor: pointer;
        }

        /* Report Card Styles */
        .report-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .score-big {
            font-size: 4rem;
            color: #28a745;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1.1rem;
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>

    <div id="game-area">
        <div class="level-indicator" id="level-indicator">Word 1 of 33</div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <h1 id="main-word">Ready?</h1>
        <p class="question-text" id="instruction">Turn up your volume.</p>
        <div class="btn-container" id="buttons">
            <button onclick="initGame()">START GAME</button>
        </div>
        
        <div class="reset-link" onclick="resetProgress()">Reset Progress (Start Over)</div>
    </div>

<script>
    // --- THE DATA ---
    const levels = [
        { display: "Creative", root: "Create", decoys: ["Creation", "Crate"], pos: "Verb" },
        { display: "Excited", root: "Excite", decoys: ["Exci", "Cited"], pos: "Verb" },
        { display: "Thirsty", root: "Thirst", decoys: ["Thirs", "Hersty"], pos: "Noun" },
        { display: "Bored", root: "Bore", decoys: ["Bo", "Ord"], pos: "Verb" },
        { display: "Confused", root: "Confuse", decoys: ["Confu", "Fused"], pos: "Verb" },
        { display: "Scared", root: "Scare", decoys: ["Sca", "Aird"], pos: "Verb" },
        { display: "Nervous", root: "Nerve", decoys: ["Nerva", "Ous"], pos: "Noun" },
        { display: "Careful", root: "Care", decoys: ["Cay", "Are"], pos: "Verb" },
        { display: "Friendly", root: "Friend", decoys: ["Frie", "End"], pos: "Noun" },
        { display: "Beautiful", root: "Beauty", decoys: ["Beaut", "Be"], pos: "Noun" },
        { display: "Complicated", root: "Complicate", decoys: ["Compli", "Cated"], pos: "Verb" },
        { display: "Closed", root: "Close", decoys: ["Clo", "Osed"], pos: "Verb" },
        { display: "Dangerous", root: "Danger", decoys: ["Dange", "Gerous"], pos: "Noun" },
        { display: "Healthy", root: "Health", decoys: ["Hell", "Elthy"], pos: "Noun" },
        { display: "Disgusting", root: "Disgust", decoys: ["Dis", "Gust"], pos: "Verb" },
        { display: "Interesting", root: "Interest", decoys: ["Inter", "Esting"], pos: "Verb" },
        { display: "Boring", root: "Bore", decoys: ["Bo", "Ring"], pos: "Verb" },
        { display: "Funny", root: "Fun", decoys: ["Fu", "Unny"], pos: "Noun" },
        { display: "Annoying", root: "Annoy", decoys: ["Anno", "Oying"], pos: "Verb" },
        { display: "Messy", root: "Mess", decoys: ["Me", "Essy"], pos: "Noun" },
        { display: "Expensive", root: "Expense", decoys: ["Expe", "Sive"], pos: "Noun" },
        { display: "Valuable", root: "Value", decoys: ["Val", "Able"], pos: "Verb" },
        { display: "Worthless", root: "Worth", decoys: ["Wore", "Less"], pos: "Noun" },
        { display: "Famous", root: "Fame", decoys: ["Fama", "Mous"], pos: "Noun" },
        { display: "Unknown", root: "Know", decoys: ["No", "Own"], pos: "Verb" },
        { display: "Different", root: "Differ", decoys: ["Diff", "Erent"], pos: "Verb" },
        { display: "Opposite", root: "Oppose", decoys: ["Oppo", "Site"], pos: "Verb" },
        { display: "Unnecessary", root: "Necessary", decoys: ["Uness", "Sary"], pos: "Adjective" },
        { display: "Impossible", root: "Possible", decoys: ["Imposs", "Sible"], pos: "Adjective" },
        { display: "Incorrect", root: "Correct", decoys: ["Incor", "Rect"], pos: "Adjective" },
        { display: "Unfair", root: "Fair", decoys: ["Unfai", "Air"], pos: "Adjective" },
        { display: "Dishonest", root: "Honest", decoys: ["Dishon", "Nest"], pos: "Adjective" }
    ];

    let currentLevelIndex = 0;
    let mistakeCount = 0; // New variable to track errors

    const mainWordEl = document.getElementById('main-word');
    const instructionEl = document.getElementById('instruction');
    const buttonsEl = document.getElementById('buttons');
    const progressBar = document.getElementById('progress-bar');
    const levelIndicator = document.getElementById('level-indicator');
    const gameArea = document.getElementById('game-area');

    // --- TEXT TO SPEECH ---
    function speak(text) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 0.9; 
        utterance.lang = "en-US";
        window.speechSynthesis.speak(utterance);
    }

    // --- SAVE SYSTEM ---
    function initGame() {
        const savedIndex = localStorage.getItem('wordGameProgress');
        const savedMistakes = localStorage.getItem('wordGameMistakes');
        
        if (savedIndex) {
            currentLevelIndex = parseInt(savedIndex);
            if (currentLevelIndex >= levels.length) currentLevelIndex = 0;
        } else {
            currentLevelIndex = 0;
        }

        if (savedMistakes) {
            mistakeCount = parseInt(savedMistakes);
        } else {
            mistakeCount = 0;
        }

        loadLevel(currentLevelIndex);
    }

    function saveProgress() {
        localStorage.setItem('wordGameProgress', currentLevelIndex);
        localStorage.setItem('wordGameMistakes', mistakeCount);
    }

    function resetProgress() {
        if(confirm("Start from the beginning?")) {
            localStorage.removeItem('wordGameProgress');
            localStorage.removeItem('wordGameMistakes');
            currentLevelIndex = 0;
            mistakeCount = 0;
            location.reload();
        }
    }

    function updateProgressUI() {
        const percentage = ((currentLevelIndex) / levels.length) * 100;
        progressBar.style.width = percentage + "%";
        levelIndicator.innerText = `Word ${currentLevelIndex + 1} of ${levels.length}`;
    }

    // --- REPORT CARD LOGIC ---
    function showReportCard() {
        const totalTasks = levels.length * 2; // 2 clicks per word
        const attempts = totalTasks + mistakeCount;
        const accuracy = Math.round((totalTasks / attempts) * 100);
        
        let rating = "Good Effort";
        if (accuracy === 100) rating = "Perfect Score!";
        else if (accuracy >= 90) rating = "Master!";
        else if (accuracy >= 80) rating = "Great Job";

        gameArea.innerHTML = `
            <div class="report-card">
                <h2>Report Card</h2>
                <div class="score-big">${accuracy}%</div>
                <div class="stat-row"><span>Total Words:</span> <span>${levels.length}</span></div>
                <div class="stat-row"><span>Mistakes:</span> <span>${mistakeCount}</span></div>
                <div class="stat-row"><span>Rating:</span> <span>${rating}</span></div>
                <p style="margin-top: 20px; color: #777; font-size: 0.9rem;">Take a screenshot and send it to your teacher!</p>
                <button onclick="resetProgress()" style="margin-top:20px;">Play Again</button>
            </div>
        `;
    }

    // --- GAME LOGIC ---
    function loadLevel(index) {
        if (index >= levels.length) {
            showReportCard();
            return;
        }

        updateProgressUI();
        const data = levels[index];
        
        // VISUALS PHASE 1
        mainWordEl.innerText = data.display;
        instructionEl.innerText = "What is the root word?";
        
        // AUDIO
        speak(data.display);

        // BUTTONS PHASE 1 (Randomize)
        let options = [data.root, ...data.decoys];
        options.sort(() => Math.random() - 0.5);

        buttonsEl.innerHTML = '';
        options.forEach(word => {
            const btn = document.createElement('button');
            btn.innerText = word;
            btn.onclick = () => checkRoot(word, data, btn);
            buttonsEl.appendChild(btn);
        });
    }

    function checkRoot(selectedWord, data, btnElement) {
        if (selectedWord === data.root) {
            // CORRECT ROOT
            btnElement.classList.add('correct');
            speak(data.root); 
            setTimeout(() => {
                loadPhase2(data);
            }, 800);
        } else {
            // WRONG ROOT
            btnElement.classList.add('wrong');
            speak("Try again");
            mistakeCount++; // Track Error
            saveProgress(); // Save the error immediately
        }
    }

    function loadPhase2(data) {
        mainWordEl.innerText = data.root;
        instructionEl.innerText = `Is "${data.root}" a Noun, Verb, or Adjective?`;
        
        buttonsEl.innerHTML = '';

        const posOptions = [
            { en: "Noun", jp: "名詞 (Meishi)" },
            { en: "Verb", jp: "動詞 (Doushi)" },
            { en: "Adjective", jp: "形容詞 (Keiyoushi)" }
        ];

        posOptions.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerHTML = `${opt.en} <span class="jp-sub">${opt.jp}</span>`;
            btn.onclick = () => checkPOS(opt.en, data, btn);
            buttonsEl.appendChild(btn);
        });
    }

    function checkPOS(selectedPos, data, btnElement) {
        if (selectedPos === data.pos) {
            // CORRECT POS
            btnElement.classList.add('correct');
            speak(`${data.root} is a ${data.pos}`);

            setTimeout(() => {
                currentLevelIndex++;
                saveProgress(); 
                loadLevel(currentLevelIndex);
            }, 2500);
        } else {
            // WRONG POS
            btnElement.classList.add('wrong');
            speak("Not quite");
            mistakeCount++; // Track Error
            saveProgress(); // Save the error immediately
        }
    }
</script>

</body>
</html>
